<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bestrafungs-Log System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            min-height: 100vh;
            color: #e0e0e0;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #0f1729 0%, #000000 100%);
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            background-image:
                linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: circuitMove 30s linear infinite;
            opacity: 0.6;
        }

        @keyframes circuitMove {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }

        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(70px);
            opacity: 0.5;
            pointer-events: none;
            z-index: 0;
            mix-blend-mode: screen;
        }

        .orb-1 {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.6) 0%, transparent 70%);
            top: -10%;
            left: 10%;
            animation: orbitFloat1 35s ease-in-out infinite;
        }

        .orb-2 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(37, 99, 235, 0.5) 0%, transparent 70%);
            top: 50%;
            right: 5%;
            animation: orbitFloat2 40s ease-in-out infinite;
        }

        @keyframes orbitFloat1 {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(100px, 80px); }
        }

        @keyframes orbitFloat2 {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-100px, -80px); }
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-box {
            background: #0a0a0a;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            border: 1px solid #1a1a1a;
            position: relative;
            z-index: 10000;
        }

        .modal-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .modal-icon.success { background: #3b82f6; }
        .modal-icon.error { background: #ef4444; }
        .modal-icon.warning { background: #f59e0b; }

        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #3b82f6;
            text-align: center;
            margin-bottom: 15px;
        }

        .modal-message {
            color: #b0b8d4;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn.success {
            background: #3b82f6;
            color: white;
        }

        .modal-btn.success:hover {
            background: #2563eb;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .modal-btn.cancel {
            background: #1a1a1a;
            color: #b0b8d4;
            border: 1px solid #333;
        }

        .modal-btn.cancel:hover {
            background: #333;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            border: 1px solid #1a1a1a;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .login-container h1 {
            color: #3b82f6;
            margin-bottom: 30px;
        }

        .discord-btn {
            background: #5865F2;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            transition: all 0.3s;
            text-decoration: none;
            font-weight: 600;
        }

        .discord-btn:hover {
            background: #4752C4;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(88, 101, 242, 0.4);
        }

        .sidebar-nav {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: #0a0a0a;
            border-right: 2px solid #1a1a1a;
            padding: 20px 0;
            z-index: 1000;
            overflow-y: auto;
        }

        .nav-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #1a1a1a;
        }

        .nav-logo {
            font-size: 1.5em;
            font-weight: bold;
            color: #3b82f6;
            margin-bottom: 10px;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #b0b8d4;
            font-weight: 500;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: #1a1a1a;
            color: white;
            border-left-color: #3b82f6;
        }

        .nav-item.active {
            background: #1a1a1a;
            color: #3b82f6;
            border-left-color: #3b82f6;
        }

        .nav-icon {
            font-size: 1.2em;
            width: 24px;
            text-align: center;
        }

        .top-bar {
            position: fixed;
            left: 280px;
            top: 0;
            right: 0;
            height: 70px;
            background: #0a0a0a;
            border-bottom: 2px solid #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 0 30px;
            z-index: 999;
        }

        .user-profile {
            position: relative;
            cursor: pointer;
        }

        .user-avatar-top {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid #3b82f6;
            transition: all 0.3s;
        }

        .user-avatar-top:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .user-info-popup {
            position: absolute;
            top: 60px;
            left: 0;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            min-width: 250px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 1001;
        }

        .user-profile:hover .user-info-popup {
            opacity: 1;
            visibility: visible;
        }

        .popup-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 2px solid #3b82f6;
            margin: 0 auto 15px;
            display: block;
        }

        .popup-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #3b82f6;
            text-align: center;
            margin-bottom: 10px;
        }

        .popup-rank {
            text-align: center;
            margin-bottom: 15px;
        }

        .user-rank {
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }

        .rank-owner { background: #ef4444; color: white; }
        .rank-admin { background: #f59e0b; color: white; }
        .rank-moderator { background: #10b981; color: white; }

        .popup-info {
            font-size: 0.9em;
            color: #b0b8d4;
            margin-bottom: 15px;
        }

        .popup-info div {
            margin-bottom: 5px;
        }

        .logout-btn {
            width: 100%;
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        .main-content {
            margin-left: 280px;
            margin-top: 70px;
            padding: 30px;
            min-height: calc(100vh - 70px);
        }

        .container {
            display: none;
        }

        .container.active {
            display: block;
        }

        .content-header {
            margin-bottom: 30px;
        }

        .content-header h1 {
            font-size: 2.5em;
            color: #3b82f6;
            margin-bottom: 10px;
        }

        .content-section {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .section-title {
            color: #3b82f6;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #b0b8d4;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            font-size: 14px;
            background: #000;
            color: #e0e0e0;
            transition: all 0.3s;
        }

        input[type="text"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            background: #3b82f6;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-weight: 600;
        }

        .btn:hover:not(:disabled) {
            background: #2563eb;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3b82f6;
        }

        .stat-label {
            font-size: 0.85em;
            opacity: 0.8;
            margin-top: 5px;
        }

        .pending-notice {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin: 50px auto;
            max-width: 600px;
        }

        .pending-notice h2 {
            color: #f59e0b;
            margin-bottom: 15px;
            font-size: 2em;
        }

        .pending-notice p {
            color: #b0b8d4;
            line-height: 1.6;
        }

        .request-card {
            background: #000;
            border: 1px solid #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .request-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
        }

        .request-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .request-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #3b82f6;
        }

        .request-info h3 {
            color: #3b82f6;
            margin-bottom: 5px;
        }

        .request-reason {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            color: #b0b8d4;
            border-left: 3px solid #3b82f6;
        }

        .request-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            flex: 1;
        }

        .action-btn.approve {
            background: #10b981;
            color: white;
        }

        .action-btn.approve:hover {
            background: #059669;
        }

        .action-btn.reject {
            background: #ef4444;
            color: white;
        }

        .action-btn.reject:hover {
            background: #dc2626;
        }

        .no-logs {
            text-align: center;
            padding: 60px;
            color: #5a6378;
            font-size: 1.2em;
        }

        @media (max-width: 1024px) {
            .sidebar-nav {
                transform: translateX(-280px);
            }

            .top-bar, .main-content {
                margin-left: 0;
                left: 0;
            }
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        ::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <!-- Access Request Modal -->
    <div class="modal-overlay" id="accessRequestModal">
        <div class="modal-box">
            <div class="modal-icon success">‚úâÔ∏è</div>
            <div class="modal-title">Zugriff anfragen</div>
            <div class="modal-message">
                <p style="margin-bottom: 15px;">Du hast noch keinen Zugriff auf das System. Bitte beschreibe kurz, warum du Zugriff ben√∂tigst:</p>
                <textarea id="accessRequestReason" placeholder="z.B. Ich bin Moderator und m√∂chte Bestrafungen eintragen..." style="width: 100%; min-height: 120px; margin-bottom: 15px; padding: 12px; border: 1px solid #1a1a1a; border-radius: 8px; background: #000; color: #e0e0e0;"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn success" onclick="submitAccessRequest()">Anfrage senden</button>
                <button class="modal-btn cancel" onclick="cancelAccessRequest()">Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-box">
            <div class="modal-icon success">‚úÖ</div>
            <div class="modal-title">Anfrage gesendet!</div>
            <div class="modal-message">
                <p>Deine Zugangsanfrage wurde erfolgreich gesendet. Ein Administrator wird sie in K√ºrze pr√ºfen.</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn success" onclick="closeSuccessModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <h1>üìò Bestrafungs-Log System</h1>
        <p style="color: #b0b8d4; margin-bottom: 30px;">Melde dich mit Discord an, um fortzufahren</p>
        <a href="#" class="discord-btn" onclick="handleDiscordLogin(event)">
            <svg width="24" height="24" viewBox="0 0 127.14 96.36" fill="currentColor">
                <path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
            </svg>
            Mit Discord anmelden
        </a>
    </div>

    <!-- App Container -->
    <div id="appContainer" style="display: none;">
        <nav class="sidebar-nav">
            <div class="nav-header">
                <div class="nav-logo">üìò Mod System</div>
            </div>
            <div class="nav-menu">
                <div class="nav-item active" onclick="navigateTo('logs')">
                    <span class="nav-icon">üìã</span>
                    <span>Bestrafungen</span>
                </div>
                <div class="nav-item" onclick="navigateTo('players')">
                    <span class="nav-icon">üë•</span>
                    <span>Spielerliste</span>
                </div>
                <div class="nav-item" id="navRequests" style="display: none;" onclick="navigateTo('requests')">
                    <span class="nav-icon">üì®</span>
                    <span>Anfragen</span>
                </div>
                <div class="nav-item" id="navAdmin" style="display: none;" onclick="navigateTo('admin')">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Admin Panel</span>
                </div>
            </div>
        </nav>

        <div class="top-bar">
            <div class="user-profile">
                <img src="" alt="Avatar" class="user-avatar-top" id="userAvatarTop">
                <div class="user-info-popup">
                    <img src="" alt="Avatar" class="popup-avatar" id="popupAvatar">
                    <div class="popup-name" id="popupName"></div>
                    <div class="popup-rank">
                        <span class="user-rank" id="popupRank"></span>
                    </div>
                    <div class="popup-info">
                        <div><strong>Discord ID:</strong> <span id="popupId"></span></div>
                        <div><strong>Status:</strong> <span id="popupStatus"></span></div>
                    </div>
                    <button class="logout-btn" onclick="logout()">Abmelden</button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Pending Access Container -->
            <div class="container active" id="pendingContainer">
                <div class="pending-notice">
                    <h2>‚è≥ Zugriff ausstehend</h2>
                    <p>Deine Zugangsanfrage wurde gesendet und wird derzeit von einem Administrator gepr√ºft. Du wirst benachrichtigt, sobald eine Entscheidung getroffen wurde.</p>
                    <p style="margin-top: 15px; font-size: 0.9em;">Bitte habe etwas Geduld. Dies kann einige Zeit in Anspruch nehmen.</p>
                </div>
            </div>

            <!-- Logs Container -->
            <div class="container" id="logsContainer">
                <div class="content-header">
                    <h1>üìã Bestrafungen</h1>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalLogs">0</div>
                        <div class="stat-label">Gesamt</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalBans">0</div>
                        <div class="stat-label">Bans</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalKicks">0</div>
                        <div class="stat-label">Kicks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalWarns">0</div>
                        <div class="stat-label">Warnungen</div>
                    </div>
                </div>

                <div class="content-section">
                    <h2 class="section-title">‚ûï Neue Bestrafung</h2>
                    <form id="punishmentForm">
                        <div class="form-group">
                            <label for="punishmentType">Bestrafungsart:</label>
                            <select id="punishmentType" required>
                                <option value="">-- Bitte w√§hlen --</option>
                                <option value="ban">Ban</option>
                                <option value="kick">Kick</option>
                                <option value="warn">Warnung</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="robloxUsername">Roblox Benutzername:</label>
                            <input type="text" id="robloxUsername" required placeholder="z.B. MaxMustermann">
                        </div>

                        <div class="form-group">
                            <label for="reason">Grund:</label>
                            <textarea id="reason" required placeholder="Detaillierte Beschreibung des Grundes..."></textarea>
                        </div>

                        <button type="submit" class="btn">Bestrafung hinzuf√ºgen</button>
                    </form>
                </div>
            </div>

            <!-- Players Container -->
            <div class="container" id="playersContainer">
                <div class="content-header">
                    <h1>üë• Spielerliste</h1>
                </div>
                <div class="content-section">
                    <div class="no-logs">Keine Spieler vorhanden</div>
                </div>
            </div>

            <!-- Requests Container -->
            <div class="container" id="requestsContainer">
                <div class="content-header">
                    <h1>üì® Zugriffs-Anfragen</h1>
                </div>
                <div class="content-section">
                    <div id="requestsList">
                        <div class="no-logs">Keine Anfragen vorhanden</div>
                    </div>
                </div>
            </div>

            <!-- Admin Container -->
            <div class="container" id="adminContainer">
                <div class="content-header">
                    <h1>‚öôÔ∏è Admin Panel</h1>
                </div>
                <div class="content-section">
                    <h2 class="section-title">Benutzerverwaltung</h2>
                    <div class="no-logs">Admin-Funktionen in Entwicklung</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WICHTIG: Ersetze dies mit deiner eigenen Discord ID
        const OWNER_ID = '123456789012345678'; // Deine Discord Owner ID hier eintragen!

        // Simulated database
        let currentUser = null;
        let accessRequests = [];
        let approvedUsers = {};

        // Initialize on page load
        window.onload = function() {
            // Check if returning from OAuth2
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (code) {
                // Simulate OAuth2 callback - In production, this would call your backend
                handleOAuthCallback(code);
            } else {
                // Check if user is already logged in
                checkExistingSession();
            }
        };

        function handleDiscordLogin(event) {
            event.preventDefault();
            // Simulate Discord OAuth2 - replace with your actual OAuth2 URL
            const clientId = '1419243337826832406';
            const redirectUri = encodeURIComponent('https://hrp-moderationlogging.vercel.app/');
            const scope = 'identify';
            
            window.location.href = `https://discord.com/oauth2/authorize?client_id=${clientId}&response_type=code&redirect_uri=${redirectUri}&scope=${scope}`;
        }

        function handleOAuthCallback(code) {
            // Simulate fetching user data from Discord
            // In production, send this code to your backend to exchange for user info
            
            // Simulated user data (replace with actual API call)
            setTimeout(() => {
                const mockUser = {
                    id: '234567890123456789', // Simulated Discord ID
                    username: 'TestUser',
                    discriminator: '1234',
                    avatar: 'https://cdn.discordapp.com/embed/avatars/0.png'
                };
                
                processLogin(mockUser);
            }, 500);
        }

        function processLogin(userData) {
            currentUser = {
                id: userData.id,
                username: userData.username + '#' + userData.discriminator,
                avatar: userData.avatar,
                rank: userData.id === OWNER_ID ? 'owner' : 'pending',
                status: userData.id === OWNER_ID ? 'approved' : 'pending'
            };

            // Save to session
            sessionStorage.setItem('currentUser', JSON.stringify(currentUser));

            // Check if user is owner or needs to request access
            if (currentUser.id === OWNER_ID) {
                // Owner gets immediate access
                showApp();
            } else {
                // Check if user already has access
                if (approvedUsers[currentUser.id]) {
                    currentUser.rank = approvedUsers[currentUser.id].rank;
                    currentUser.status = 'approved';
                    showApp();
                } else {
                    // Check if user already requested access
                    const existingRequest = accessRequests.find(r => r.userId === currentUser.id);
                    if (existingRequest) {
                        showPendingScreen();
                    } else {
                        showAccessRequestModal();
                    }
                }
            }
        }

        function checkExistingSession() {
            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                
                if (currentUser.status === 'approved') {
                    showApp();
                } else {
                    showPendingScreen();
                }
            }
        }

        function showAccessRequestModal() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('accessRequestModal').classList.add('active');
        }

        function submitAccessRequest() {
            const reason = document.getElementById('accessRequestReason').value.trim();
            
            if (!reason) {
                alert('Bitte gib einen Grund f√ºr deine Anfrage an.');
                return;
            }

            // Create access request
            const request = {
                id: Date.now(),
                userId: currentUser.id,
                username: currentUser.username,
                avatar: currentUser.avatar,
                reason: reason,
                timestamp: new Date().toISOString(),
                status: 'pending'
            };

            accessRequests.push(request);
            
            // Save to localStorage (simulated database)
            localStorage.setItem('accessRequests', JSON.stringify(accessRequests));

            // Close modal and show pending screen
            document.getElementById('accessRequestModal').classList.remove('active');
            document.getElementById('successModal').classList.add('active');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
            showPendingScreen();
        }

        function cancelAccessRequest() {
            document.getElementById('accessRequestModal').classList.remove('active');
            logout();
        }

        function showPendingScreen() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            // Update user profile
            updateUserProfile();
            
            // Show only pending container
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            document.getElementById('pendingContainer').classList.add('active');
        }

        function showApp() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            // Update user profile
            updateUserProfile();
            
            // Show appropriate navigation items based on rank
            if (currentUser.rank === 'owner' || currentUser.rank === 'admin') {
                document.getElementById('navRequests').style.display = 'flex';
                document.getElementById('navAdmin').style.display = 'flex';
                loadAccessRequests();
            }
            
            // Hide pending container, show logs
            document.getElementById('pendingContainer').classList.remove('active');
            document.getElementById('logsContainer').classList.add('active');
            
            // Load data
            loadPunishments();
        }

        function updateUserProfile() {
            // Update avatar
            document.getElementById('userAvatarTop').src = currentUser.avatar;
            document.getElementById('popupAvatar').src = currentUser.avatar;
            
            // Update name
            document.getElementById('popupName').textContent = currentUser.username;
            
            // Update rank
            const rankElement = document.getElementById('popupRank');
            const rankText = {
                'owner': 'Owner',
                'admin': 'Administrator',
                'moderator': 'Moderator',
                'pending': 'Ausstehend'
            };
            rankElement.textContent = rankText[currentUser.rank] || 'Benutzer';
            rankElement.className = 'user-rank rank-' + currentUser.rank;
            
            // Update ID
            document.getElementById('popupId').textContent = currentUser.id;
            
            // Update status
            document.getElementById('popupStatus').textContent = currentUser.status === 'approved' ? 'Genehmigt' : 'Ausstehend';
        }

        function loadAccessRequests() {
            const saved = localStorage.getItem('accessRequests');
            if (saved) {
                accessRequests = JSON.parse(saved);
            }
            
            const listContainer = document.getElementById('requestsList');
            
            if (accessRequests.length === 0) {
                listContainer.innerHTML = '<div class="no-logs">Keine Anfragen vorhanden</div>';
                return;
            }
            
            listContainer.innerHTML = accessRequests.map(request => `
                <div class="request-card">
                    <div class="request-header">
                        <img src="${request.avatar}" alt="Avatar" class="request-avatar">
                        <div class="request-info">
                            <h3>${request.username}</h3>
                            <small style="color: #b0b8d4;">Discord ID: ${request.userId}</small>
                        </div>
                    </div>
                    <div class="request-reason">
                        <strong style="color: #3b82f6;">Grund:</strong><br>
                        ${request.reason}
                    </div>
                    <div style="font-size: 0.85em; color: #5a6378; margin-bottom: 15px;">
                        Angefragt am: ${new Date(request.timestamp).toLocaleString('de-DE')}
                    </div>
                    <div class="request-actions">
                        <button class="action-btn approve" onclick="approveRequest(${request.id})">
                            ‚úì Genehmigen
                        </button>
                        <button class="action-btn reject" onclick="rejectRequest(${request.id})">
                            ‚úó Ablehnen
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function approveRequest(requestId) {
            const request = accessRequests.find(r => r.id === requestId);
            if (!request) return;
            
            // Add to approved users
            approvedUsers[request.userId] = {
                rank: 'moderator',
                approvedBy: currentUser.id,
                approvedAt: new Date().toISOString()
            };
            
            // Remove from requests
            accessRequests = accessRequests.filter(r => r.id !== requestId);
            
            // Save changes
            localStorage.setItem('approvedUsers', JSON.stringify(approvedUsers));
            localStorage.setItem('accessRequests', JSON.stringify(accessRequests));
            
            // Reload requests
            loadAccessRequests();
            
            alert(`Zugriff f√ºr ${request.username} wurde genehmigt!`);
        }

        function rejectRequest(requestId) {
            const request = accessRequests.find(r => r.id === requestId);
            if (!request) return;
            
            if (confirm(`M√∂chtest du die Anfrage von ${request.username} wirklich ablehnen?`)) {
                accessRequests = accessRequests.filter(r => r.id !== requestId);
                localStorage.setItem('accessRequests', JSON.stringify(accessRequests));
                loadAccessRequests();
                alert('Anfrage wurde abgelehnt.');
            }
        }

        function loadPunishments() {
            // Simulated punishment data
            document.getElementById('totalLogs').textContent = '0';
            document.getElementById('totalBans').textContent = '0';
            document.getElementById('totalKicks').textContent = '0';
            document.getElementById('totalWarns').textContent = '0';
        }

        function navigateTo(page) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Show correct container
            document.querySelectorAll('.container').forEach(container => {
                container.classList.remove('active');
            });
            
            const containerMap = {
                'logs': 'logsContainer',
                'players': 'playersContainer',
                'requests': 'requestsContainer',
                'admin': 'adminContainer'
            };
            
            document.getElementById(containerMap[page]).classList.add('active');
        }

        function logout() {
            if (confirm('M√∂chtest du dich wirklich abmelden?')) {
                sessionStorage.removeItem('currentUser');
                currentUser = null;
                
                document.getElementById('appContainer').style.display = 'none';
                document.getElementById('loginContainer').style.display = 'block';
                
                // Clear URL parameters
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // Punishment Form Handler
        document.getElementById('punishmentForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const type = document.getElementById('punishmentType').value;
            const username = document.getElementById('robloxUsername').value;
            const reason = document.getElementById('reason').value;
            
            if (!type || !username || !reason) {
                alert('Bitte f√ºlle alle Felder aus!');
                return;
            }
            
            alert(`Bestrafung hinzugef√ºgt!\n\nTyp: ${type}\nBenutzer: ${username}\nGrund: ${reason}`);
            
            // Reset form
            this.reset();
        });

        // Load saved data on init
        const savedApproved = localStorage.getItem('approvedUsers');
        if (savedApproved) {
            approvedUsers = JSON.parse(savedApproved);
        }

        const savedRequests = localStorage.getItem('accessRequests');
        if (savedRequests) {
            accessRequests = JSON.parse(savedRequests);
        }
    </script>
</body>
</html>
